# 🌡️ PolyWeather: Polymarket 天气交易监控系统

基于多源实时气象数据与 Polymarket 市场定价偏差分析的智能监控与指令系统。

## 🚀 运行指令 (一键启动)

```powershell
python run.py
```

该命令会同时启动：

1. **监控引擎**: 负责 7x24h 扫描并推送 **85¢-95¢ 价格预警** 与 **市场异常**。
2. **指令监听器**: 监听电报指令并返回实时信号。

---

## 🤖 电报机器人指令集

| 指令      | 描述             | 用法                          |
| :-------- | :--------------- | :---------------------------- |
| `/signal` | **获取交易信号** | 返回当前最值得关注的 3 个档位 |
| `/status` | **检查系统状态** | 确认监控引擎是否在线          |
| `/help`   | **指令帮助**     | 显示所有可用指令              |

---

## 📢 推送维度说明

### 1. 📂 城市预警汇总 (主动推送)

- **优化机制**: 同一轮扫描中，同一城市的所有异动将**合并为一条消息**发送，拒绝刷屏。
- **触发内容**: 包含该城市下所有符合条件的“价格预警”与“市场异常”。

### 2. ⚡ 价格预警

- **触发条件**: Buy Yes 或 Buy No 价格在 **85¢-95¢** 区间。
- **用途**: 高胜率/即将锁定区间提醒，适合平仓或收割。

### 3. 👀 市场异常

- **大户入场**: 检测到单笔 >$5000 的大额交易且买卖比失衡。
- **异常交易流**: 成交量突然放大 (>2倍历史标准差)。

### 4. 🎯 交易信号 (指令查询)

- 对比气象预报与市场价格偏差。
- 包含：城市、档位、当地时间、预期温度（含单位自适应）、偏差评分。

---

## 🛠️ 环境配置 (.env)

```bash
# Telegram 机器人
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# Polymarket API (用于批量获取实时盘口价格与交易历史)
POLYMARKET_API_KEY=019c2d40-5d23-75a6-ab33-02ae5d2a033e

# 代理设置 (如需要)
HTTPS_PROXY=http://127.0.0.1:7890
HTTP_PROXY=http://127.0.0.1:7890
```

---

## 📋 核心功能特性

- ✅ **智能合并推送**: 按城市汇总预警，界面整洁不刷屏。
- ✅ **极速价格同步**: 采用批量 API 接口，一次请求同步全量城市盘口价，无延迟、无 404。
- ✅ **北京时间适配**: 所有推送时间戳已自动转换为北京时间 (UTC+8)。
- ✅ **智能日期选择**: 自动定位最早的活跃市场日期，结算后自动顺延。
- ✅ **温度单位自适应**: 美国市场自动切换华氏度 (°F)，其他地区显示摄氏度 (°C)。
- ✅ **全量数据持久化**: 信号记录与推送历史保存至本地 JSON，重启不丢失，不重复。

---
