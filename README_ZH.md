# 🌡️ PolyWeather: 实时天气查询与态势分析机器人

基于多源实时气象数据（Open-Meteo、NOAA METAR）的智能天气分析系统。该系统专为速度与准确性设计，通过强制穿透网络缓存，为用户提供全球气象站最即时的实测报告与态势逻辑分析。

## 🚀 快速开始

### 环境依赖

- **Python 3.11+**
- 安装依赖: `pip install -r requirements.txt`

### 启动运行 (Windows/Linux)

```bash
# Windows
py -3.11 run.py

# Linux/VPS
python3 run.py
```

_注：系统当前运行于**天气查询模式**。主动市场监控引擎和自动模拟交易模块已暂时关闭。_

---

## 🤖 电报机器人指令 (Telegram)

| 指令             | 描述             | 用法                                     |
| :--------------- | :--------------- | :--------------------------------------- |
| `/city [城市名]` | **查询城市天气** | 获取预测、机场实测及深度的“态势分析”结论 |
| `/id`            | **获取 Chat ID** | 获取当前聊天的唯一 ID                    |
| `/help`          | **帮助**         | 显示所有可用指令                         |

### /city 指令示例

```
/city 伦敦
```

**实时输出效果：**

> 📍 **London 天气详情**  
> ⏱️ 生成时间: 00:41:17  
> ═══ ═══ ═══ ═══ ═══ ═══  
> 🕐 当地时间: 16:41
>
> 📊 **Open-Meteo 7天预测**  
> 👉 今天: 最高 12°C  
>  02-09: 最高 11°C
>
> ✈️ **机场实测 (EGLC)**  
>  🌡️ 10.0°C  
>  💨 风速: 12kt  
>  🕐 观测: 16:20 (当地)
>
> 💡 **态势分析**  
> 📉 **处于降温期**：气温已开始从峰值下滑，今日大概率不会再反弹。  
> 🍃 **清劲风**：空气流动快，虽然有助于散热，但可能伴随阵风引起微小波动。

---

## ✨ 核心特性

### 1. 💡 智能态势分析 (Trend Analysis)

机器人不再只是罗列数字，它通过**实测对比预测**的逻辑进行深度解读：

- **峰值判定**：分析当前时间点，判断日间最高温是否已经产生。
- **物理态势**：利用湿度和露点数据，分析夜间气温是否存在“跌不动”的支撑点。
- **波动预警**：根据机场风速监控，预警可能导致气温突变的锋面过境。

### 2. ✈️ 高保真机场实测 (METAR)

直接对接 **NOAA (美国国家海洋和大气管理局)** 的官方接口：

- **自动时区转换**：将机场 UTC 观测时间自动转换为**城市当地时间**。
- **专业级参数**：获取温度、风速、露点、相对湿度等专业观测值。

### 3. ⚡ 数据绝对实时 (Cache Busting)

针对网络代理和 CDN 缓存进行了底层加固：

- 每一个 API 请求均带有**微秒级随机时间戳**。
- 强制穿透所有中间缓存，确保获取的是气象站此时此刻的最新读数。

---

## 🏗️ 架构说明

本项目包含一套遗留的 **监控引擎 (Monitoring Engine)** 和 **模拟交易系统 (Paper Trading)**（位于 `main.py`）。为了提供最高效的点对点天气查询服务，目前这些功能已处于**休眠状态**。

- 如需重新启用：请取消 `run.py` 中 `monitor_thread.start()` 的注释。
- 遗留功能文档参见：[市场扫描说明](./MARKET_DISCOVERY_ZH.md) 和 [模拟交易指南](./PAPER_TRADING_GUIDE.md)。
