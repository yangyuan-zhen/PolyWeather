# 🌡️ PolyWeather: 实时天气查询与分析机器人

一个智能天气信息机器人，专为提供超快、实时的气象数据、高保真预报和智能趋势分析而设计。通过绕过网络缓存，直接从全球气象站获取最新数据。

## 🚀 快速开始

### 环境要求

- **Python 3.11+**
- 依赖安装: `pip install -r requirements.txt`

### 本地运行 (Windows/Linux)

```bash
# Windows
py -3.11 run.py

# Linux/VPS
python3 run.py
```

_注意：系统当前处于 **天气查询模式**。主动市场监控和自动交易模块已暂停。_

---

## 🤖 Telegram 机器人指令

| 指令           | 功能             | 说明                             |
| :------------- | :--------------- | :------------------------------- |
| `/city [城市]` | **查询城市天气** | 获取详细预报、机场实测与趋势分析 |
| `/id`          | **获取 Chat ID** | 获取当前 Telegram 聊天 ID        |
| `/help`        | **帮助**         | 显示所有可用指令                 |

### /city 指令示例

```
/city 芝加哥
```

**实时输出：**

> 📍 **Chicago 天气详情**  
> ⏱️ 生成时间: 12:45:30  
> ════════════════════  
> 🕐 当地时间: 12:45
>
> 📊 **Open-Meteo 7天预测**  
> 👉 今天: 最高 22.4°F (NWS: 23°F)  
>  02-08: 最高 26.2°F  
>  02-09: 最高 37.2°F
>
> ✈️ **机场实测 (KORD)**  
>  🌡️ 21.0°F (今日最高: 23.0°F)  
>  💨 风速: 4kt  
>  🕐 观测: 12:00 (当地)
>
> 💡 **态势分析**  
> ⏱️ **预计峰值时刻**：今天 14:00 - 16:00 之间。  
> � **博弈建议**：关注该时段实测能否站稳 22.4°F。  
> 📈 **升温进程中**：距离峰值还有约 1.4° 空间，正向高点冲击。

---

## ✨ 核心功能

### 1. 🏛️ 多源数据融合

机器人聚合多个权威数据源：

| 数据源         | 数据类型     | 覆盖范围      |
| -------------- | ------------ | ------------- |
| **Open-Meteo** | 7天预报      | 全球          |
| **NWS**        | 美国官方预报 | 仅美国城市 ⚠️ |
| **METAR**      | 机场实时观测 | 全球主要机场  |

- **⚠️ 分歧预警**：当 Open-Meteo 和 NWS 预测差异超过 1°F 时，机器人会标注提醒。

### 2. ⏱️ 峰值时刻预测

机器人分析每个城市的逐小时预报曲线，识别：

- **精确峰值窗口**：如 "14:00 - 16:00"
- **博弈建议**：在此窗口期关注实测数据变化

### 3. 📊 今日最高温追踪

METAR 数据按**当地日历日**过滤（使用 UTC 偏移）：

- 只统计**当地零点之后**的观测记录
- 确保"今日最高"准确，不受昨天下午高温干扰

### 4. ✈️ 高保真机场数据 (METAR)

直连 **NOAA 航空气象中心**，获取原始 METAR 数据：

- 自动将 UTC 时间转换为**城市当地时间**
- 实时观测（温度、风速、露点）

### 5. ⚡ 超新鲜数据（缓存穿透）

专门设计以绕过 ISP 和代理缓存：

- 每次请求附带**微秒时间戳令牌**
- 强制 Open-Meteo/NOAA/NWS 返回最新数据

---

## 🎯 博弈策略提示

1. **检查模型共识**：如果 Open-Meteo 和 NWS 一致，置信度高。
2. **关注峰值窗口**：在预测的峰值时段多次刷新 METAR。
3. **使用"今日最高"**：对比实测峰值与预报值。
4. **解读 ⚠️ 警告**：分歧意味着不确定性——谨慎操作。

---

## 🏗️ 架构说明

项目包含一个遗留的**监控引擎**和**模拟交易系统**（位于 `main.py`）。这些功能目前**已停用**，以优先保障高速按需天气查询。

- 重新启用监控：取消 `run.py` 中 `monitor_thread.start()` 的注释。
- 已停用功能的文档：参见 [MARKET_DISCOVERY_ZH.md](./MARKET_DISCOVERY_ZH.md) 和 [PAPER_TRADING_GUIDE.md](./PAPER_TRADING_GUIDE.md)。
