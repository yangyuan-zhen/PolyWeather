# 📈 PolyWeather 模拟仓 (Paper Trading) 使用指南

> ⚠️ **当前状态：功能暂停**  
> 为了专注于高实时性的天气查询服务，自动模拟交易功能目前已在代码中被禁用。电报指令 `/portfolio` 暂不可用。

本系统提供全自动的模拟交易功能，让您在不投入真实资金的情况下，验证天气预测逻辑的盈利能力。

## 🛠️ 运行机制

1.  **自动开仓**:
    - 监控引擎在扫描中，一旦发现任何档位的 **Buy Yes** 或 **Buy No** 价格处于 **85¢ - 95¢** 区间（与城市监控报告一致），即触发买入。
    - 初始本金: **$1000.00**
    - 单笔投入: **动态 $3-$10**（根据四层风控策略自动调整，见下文）
    - 资金检查: 余额不足时将停止开仓。
    - **价格来源**: 使用真实 **Ask 价格**（实际可成交价格），而非中间价
2.  **实时估值**:
    - 每轮扫描结束后，系统会根据最新盘口中间价更新持仓价值。
3.  **自动结项**:
    - 当市场价格达到 0¢ 或 100¢（Polymarket 已结算），系统自动平仓并计算盈亏，资金回笼。
4.  **数据持久化**:
    - 持仓与余额保存在 `data/paper_positions.json`。

## 🎯 四层风控仓位策略

系统结合 **Open-Meteo 天气预测**、**结算时间** 和 **成交量** 自动决定仓位大小：

| 条件组合                        | 基础仓位 | 标签       | 说明           |
| ------------------------------- | -------- | ---------- | -------------- |
| 价格 ≥90¢ + 天气支持 + 高成交量 | **$10**  | 🔥高置信   | 三重确认，重注 |
| 价格 ≥90¢ + 天气支持            | **$7**   | ⭐中置信   | 双重确认       |
| 价格 ≥92¢                       | **$5**   | 📌价格锁定 | 纯价格锁定     |
| 其他 85-91¢                     | **$3**   | 💡试探     | 最小仓位试探   |

### 风控过滤规则

1. **时间衰减**:
   - ≤1小时: 停止建仓 (0%)
   - 1-4小时: 缩小至 40%
   - 4-12小时: 缩小至 70%
   - > 12小时: 100%
2. **预算上限**: 每日最高投入 $50
3. **成交量加权**: 低活跃市场额外缩减 20%

### 天气支持判断逻辑

- **买 NO**: Open-Meteo 预测温度在选项区间 **之外** (±2° 容差)
- **买 YES**: Open-Meteo 预测温度 **落入** 选项区间

### 策略建议显示

当推送包含交易信号时，会附带策略建议：

```
💡 策略建议:
• 预测温度19.0°C落在21°C区间，市场与模型一致
```

### METAR 实测数据

当天结算的市场会额外显示机场实测数据，帮助验证预测准确性：

```
✈️ 机场实测 (KORD):
   🌡️ 32.0°F | 风速:12kt
   🕐 观测: 14:00 UTC
```

## 📊 盈亏计算公式

- **持仓份额** = $5 / (买入价格 / 100)
- **可用余额** = 初始本金 - 累计投入总额
- **浮动盈亏** = 当前总价值 - 投入本金 ($5)

## 🤖 电报指令

您可以直接在机器人中通过以下指令查看进度：

- **/portfolio**: 实时返回当前所有“浮动”持仓的盈亏状况、历史胜率以及账户余额。

## 📁 存储文件说明

如果您需要手动清理或修改仓位，可以编辑 `data/paper_positions.json`。

- `status: "OPEN"` 表示正在持仓。
- `entry_price` 以美分为单位（如 91 表示 0.91$）。

---

**蚂蚁重力 (Antigravity) 实验室**
